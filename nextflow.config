nextflow.enable.dsl = 2
nextflowVersion = '>=20'

profiles {

// test profile name needs to change to AWS. 
// Add reference files to s3 buckets as we test on ec2 instance

    aws_agc_test {
        docker.enabled = true
        
        includeConfig 'config/docker.config'
        
        report {
            enabled = true
            overwrite = true
            file = "s3://agc-913060503860-us-west-2/reports/report.html"
        }
        
        params {
            reads = "s3://ccr-genomics-testdata/testdata/Test*_R_T_R{1,2}.fastq.gz"
            publishDirMode = "copy"
            star_genome_index = "s3://ccr-genomics-testdata/References/index-STAR_2.7.9a"
            gtf = "s3://ccr-genomics-testdata/References/gencode.v37lift37.annotation_ERCC92.gtf"
            rsem_index = "s3://ccr-genomics-testdata/References/rsem_1.3.2"
            resultsdir = "s3://agc-424336837382-us-east-1/nfmvpout_vnk"
            fusioncatcher_db = "s3://ccr-genomics-testdata/References/fusioncatcher/human_v108"
            mixcr_license = "s3://ccr-genomics-testdata/Licenses/mi.license"
            starfusion_db = "s3://ccr-genomics-testdata/References/STARfusion/GRCh37_gencode_v19_CTAT_lib_Mar012021.plug-n-play/ctat_genome_lib_build_dir/"
        }
        process {
            cpus = 2
            memory = '3 GB'

            withName: Star {
               cpus = 8
               memory = '32 GB'
               time = '5h'
           }    

        }
    }

    biowulf_test_run_local {

        params {
            config_profile_description = 'BIOWULF small test on LOCAL interactive node'
            config_profile_contact = 'kopardevn@nih.gov'
            // config_profile_url = 'https://hpc.nih.gov/apps/nextflow.html'
            max_memory = '20.GB'
            max_cpus = '3' 
            max_time = '4h'
        }
        includeConfig 'config/biowulf_small_test_params.config'
        includeConfig 'config/docker.config'
        includeConfig 'config/biowulf_singularity.config'
	    workDir = "$OUTDIR/work.$OUTTAG"
	    //resultsDir = "$OUTDIR/results"
        process {
            executor = 'local'
        }
    }

    biowulf_test_run_slurm {
        params {
            includeConfig 'config/docker.config'
            config_profile_description = 'BIOWULF small test on SLURM'
            config_profile_contact = 'kopardevn@nih.gov'
            config_profile_url = 'https://hpc.nih.gov/apps/nextflow.html'
            max_memory = '20.GB'
            max_cpus = '3' 
            max_time = '4h'
        }
        includeConfig 'config/biowulf_small_test_params.config'
        includeConfig 'config/docker.config'
        includeConfig 'config/biowulf_singularity.config'
        includeConfig 'config/biowulf_cluster_test.config'
	    workDir = "$OUTDIR/work.$OUTTAG"
	    //resultsDir = "$OUTDIR/results"
    }

}

