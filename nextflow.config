profiles {
    test_nextflow {
        process {
            cpus = 2
            memory = '3 GB'

            withName: star {
               cpus = 8
               memory = '32 GB'
               time = '5h'
           }    

        }
    }
    biowulf {
        process {
            executor = 'slurm'
            queue = 'norm'
            queueSize = 100
            errorStrategy = 'finish'
            maxRetries = 0
            pollInterval = '1 min'
            queueStatInterval = '5 min'
            submitRateLimit = '6/1min'
//            scratch = '/lscratch/$SLURM_JOBID'
            clusterOptions = ' --gres=lscratch:400'

            withName: cutadapt {
               cpus = '4'
               memory = '2 GB'
               queue = 'quick'
               time = '2h'
           }

            withName: fastqc {
               cpus = '4'
               memory = '2 GB'
               queue = 'quick'
               time = '2h'
           }

            withName: star {
               cpus = '16'
               memory = '120 GB'
               queue = 'ccr,norm'
               time = '20h'
           }
            withName: rsem {
               cpus = '16'
               memory = '120 GB'
               queue = 'ccr,norm'
               time = '20h'
           }
            withName: multiqc {
               cpus = '4'
               memory = '50 GB'
               queue = 'ccr,norm'
               time = '4h'
           }	
        
        }
	singularity.enabled = true
        singularity.autoMounts = true
        singularity.cacheDir = "$PWD/singularity"
        singularity.envWhitelist='https_proxy,http_proxy,ftp_proxy,DISPLAY,SLURM_JOBID'

    }
    testparams_nextflow {
        params {
            reads              = "s3://ccr-genomics-testdata/testdata/Test*_R_T_R{1,2}.fastq.gz",
            genome_index       = "s3://ccr-genomics-testdata/References/index-STAR_2.7.9a",
            gtf                = "s3://ccr-genomics-testdata/References/gencode.v37lift37.annotation_ERCC92.gtf",
            rsem_index         = "s3://ccr-genomics-testdata/References/rsem_1.3.2",
            s3_bucket          = "s3://agc-424336837382-us-east-1"
        }
    }

}

docker.enabled = true
nextflow.enable.dsl=2
